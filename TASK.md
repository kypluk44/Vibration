Отлично! Обновляю ТЗ с учетом бэкенда на Python и использования LangGraph для персонализированных AI-агентов (аватары с индивидуальной историей и развитием). Приложение становится гибридным: фронтенд (React) + сервер на Python с LangGraph.

⸻

Техническое задание (ТЗ)

MVP веб-игры с индивидуальными AI-агентами на базе LangGraph

⸻

1. Цель проекта

Создать веб-приложение-игру для повышения вовлеченности в страховые продукты «Энергогарант» с помощью персонализированных историй и сценариев, генерируемых AI-агентом для каждого пользователя на сервере.

⸻

2. Архитектура

Frontend:
	•	React + TypeScript — UI/UX
	•	Vite
	•	TailwindCSS
	•	State management — Zustand/Recoil
	•	API-интеграция с сервером (REST или WebSocket)
	•	localStorage — для кеширования части данных на клиенте

Backend:
	•	Python 3.10+
	•	FastAPI — REST API
	•	LangGraph — создание и управление персональными агентами для каждого пользователя
	•	Redis/PostgreSQL — хранение состояния пользователя и истории агента (можно начинать с Redis)
	•	Auth — JWT или сессии (опционально)

⸻

3. Ключевые особенности и механики

3.1. Персональный AI-агент (LangGraph)
	•	Для каждого пользователя создается отдельный AI-агент (экземпляр LangGraph), хранящий:
	•	Персональную историю и прогресс
	•	Профиль, статус, события, streak
	•	Предпочтения, частые выборы пользователя
	•	Агенты управляются через backend, взаимодействие происходит по API.

3.2. Генерация и развитие аватара
	•	При первом входе backend-агент генерирует аватара, профиль и уникальную биографию, учитывая предпочтения (или случайно).
	•	Профиль хранится на сервере и может модифицироваться по ходу игры.

3.3. Ежедневные сценарии, мини-игры, советы
	•	Каждый день агент генерирует персональный игровой сценарий (mini-story/day quest), учитывая индивидуальный опыт пользователя.
	•	Сценарии, выборы, последствия — все хранится и развивается в state агента.
	•	По итогам сценария AI-агент дает совет по страхованию, релевантный ситуации и опыту игрока.

3.4. Система streak и коллекции
	•	Backend хранит streak, выдает награды и коллекционные предметы (также через агента).
	•	Коллекции, ачивки и прогресс доступны на клиенте через запрос к API.

3.5. Ограниченные события
	•	Backend-агент может предлагать сезонные или уникальные события, основанные на истории пользователя.

3.6. Уведомления
	•	Сервер может формировать персональные сообщения и напоминания (push/email — опционально).

⸻

4. User Flow
	1.	Регистрация/авторизация (если нужно)
	2.	Запрос к backend:
	•	/start — создать/получить профиль агента, аватара, бэкграунд
	3.	Каждый день:
	•	/scenario/today — получить персональный сценарий дня
	•	/action — отправить выбор пользователя, получить последствия, награду и совет
	4.	Коллекции, streak, история
	•	/profile — получить актуальное состояние, коллекции, streak, ачивки

⸻

5. Взаимодействие с LangGraph
	•	Каждый агент — это изолированная LangGraph-схема, state которой ассоциирован с user_id.
	•	Основные узлы graph:
	•	Профиль (инит, апдейт)
	•	Генерация сценариев (ежедневно, с учетом истории)
	•	Обработка действий и последствий
	•	Генерация советов
	•	Коллекции/ачивки
	•	Интеграция LangGraph + FastAPI:
	•	При каждом запросе пользователя backend “будит” агента, агент на основе актуального стейта выдает сценарий/совет/результат.
	•	Все промежуточные состояния (история, коллекции, streak) хранятся в Redis/PostgreSQL (можно хранить как pickle, json, либо через кастомные LangGraph storage adapters).

⸻

6. Пример API
	•	POST /api/start — создать/вернуть агента, вернуть аватара
	•	GET /api/scenario/today — получить сценарий сегодняшнего дня
	•	POST /api/action — отправить выбор пользователя, получить результат, последствия, совет
	•	GET /api/profile — актуальное состояние, streak, коллекции

⸻

7. AI-промты (управляются LangGraph agent’ом)
	•	Генерация аватара:

Придумай короткую биографию и профиль персонажа для страховой игры. Включи: пол, возраст, город, профессию, хобби, необычный факт. Сохрани в json.


	•	Генерация сценария:

Сгенерируй сценарий дня для персонажа: [json профиля], учитывая его предыдущий опыт и коллекции. В сценарии опиши событие и варианты действий.


	•	Генерация совета:

На основе выбора пользователя и ситуации дня дай совет по подходящему страховому продукту компании, кратко и по делу.



⸻

8. MVP-фичи
	•	Уникальный агент для каждого пользователя, индивидуальный прогресс
	•	Ежедневный сценарий и советы от AI
	•	Система streak и коллекций, награды за активность
	•	Быстрые сессии (короткий игровой день, мини-игра, выбор)
	•	Вся логика на сервере, фронт только UI и общение с API

⸻

9. Ограничения
	•	Для MVP использовать Redis для хранения стейтов агентов (можно мигрировать на БД позже)
	•	На одного пользователя — один агент, ассоциация по user_id
	•	Простая авторизация (token/session)
	•	MVP не хранит чувствительные данные, фокус на персонализации историй

⸻

10. Критерии успешного MVP
	•	Пользователь получает уникального аватара, ежедневно видит новый сценарий, получает советы и ачивки
	•	История, коллекции, streak хранятся и корректно обновляются сервером через агента
	•	Клиент стабильно взаимодействует с API, быстрая загрузка и понятный flow

⸻

Если нужна структура backend на FastAPI + LangGraph, пример кода агента, либо OpenAPI-спека — напиши, подготовлю.
Если что-то дополнить или сократить — скажи!
